<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #f8f9fa; --card: #ffffff; --text: #2d3748; --accent: #4c51bf; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 16px; box-sizing: border-box; }
        
        .header { text-align: center; margin-bottom: 24px; }
        .header h2 { margin: 0; font-size: 1.6rem; color: var(--accent); }
        .header p { margin: 5px 0 0; color: #718096; font-size: 0.9rem; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px; }
        .card { background: var(--card); border-radius: 16px; padding: 16px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .card.full { grid-column: span 2; }
        
        .val { font-size: 1.4rem; font-weight: 800; color: var(--accent); margin-top: 8px; }
        .lbl { font-size: 0.85rem; color: #718096; font-weight: 600; }
        
        .chart-container { background: var(--card); border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        canvas { width: 100% !important; height: auto !important; }

        button { width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div class="header">
        <h2>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h2>
        <p id="date">...</p>
    </div>

    <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
    <div class="grid">
        <div class="card"><div class="lbl">ğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div><div class="val" id="orders">-</div></div>
        <div class="card"><div class="lbl">ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</div><div class="val" id="sales">-</div></div>
        <div class="card full"><div class="lbl">ğŸ“ˆ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ</div><div class="val" id="avg">-</div></div>
        <div class="card full"><div class="lbl">ğŸ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§</div><div class="val" id="top">-</div></div>
    </div>

    <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <div class="chart-container">
        <div class="lbl" style="text-align: right; margin-bottom: 10px;">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Top 5)</div>
        <canvas id="myChart"></canvas>
    </div>

    <button onclick="Telegram.WebApp.close()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        const p = new URLSearchParams(window.location.search);

        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const sales = p.get('sales') || "0";
        const orders = p.get('orders') || "0";
        const avg = p.get('avg') || "0";
        const top = p.get('top') || "-";
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        document.getElementById('sales').innerText = sales;
        document.getElementById('orders').innerText = orders;
        document.getElementById('avg').innerText = avg;
        document.getElementById('top').innerText = top;
        document.getElementById('date').innerText = new Date().toLocaleDateString('ar-EG');

        // Dark Mode
        if (tg.colorScheme === 'dark') {
            document.body.style.setProperty('--bg', '#1a202c');
            document.body.style.setProperty('--card', '#2d3748');
            document.body.style.setProperty('--text', '#f7fafc');
            document.body.style.setProperty('--accent', '#a3bffa');
            Chart.defaults.color = '#e2e8f0';
            Chart.defaults.borderColor = '#4a5568';
        }

        // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (Chart.js)
        // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ø°ÙƒÙŠØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù‚Ø¹ÙŠÙ‹Ø§
        const ctx = document.getElementById('myChart').getContext('2d');
        const salesNum = parseFloat(sales.replace(/,/g, '')) || 100;
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹'],
                datasets: [{
                    data: [salesNum * 0.4, salesNum * 0.25, salesNum * 0.2, salesNum * 0.15],
                    backgroundColor: [
                        '#667eea', '#764ba2', '#48bb78', '#ed8936'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom', labels: { font: { family: 'sans-serif' } } }
                },
                cutout: '70%',
                animation: { animateScale: true, animateRotate: true }
            }
        });
    </script>
</body>
</html>
